(function($){$.fn.extend({posterize:function(options){var defaults={url:false,params:{},column:4,columnClass:'column',posterClass:'poster',posterHoverClass:'hover',checkInterval:500,uniqueKey:null,pagerWrapper:null,spinnerHtml:'<div class="spinner"></div>',initLoad:false,debug:false};var options=$.extend(defaults,options);return this.each(function(){var container=this;container.loadMore=function(){if(false==options.url)return;container.processing=true;$spinner.show();$.getJSON(options.url,container.params,function(response){$spinner.hide();if(true==response.status){if(response.html){$.each(response.html,function(k,v){if(null!=options.uniqueKey&&undefined!=response[options.uniqueKey]&&-1!=$.inArray(response[options.uniqueKey][k],container.uniqueIds)){return;}
var key=container.colsHeight.min_key();var $e=$(v);container.cols[key].append($e);container.colsHeight[key]+=$e.height();options.debug&&console.log(container.colsHeight);});if(null!=options.uniqueKey&&undefined!=response[options.uniqueKey]){container.uniqueIds=response[options.uniqueKey];}
container.bindHover();}
if(undefined!==response.pagerHtml&&undefined!==container.pagerWrapper){$(container.pagerWrapper).html(response.pagerHtml);}
if(undefined!==typeof(response.params)){container.params=$.extend(container.params,response.params);}
container.finish=response.finish||false;container.processing=false;if(!container.finish){container.check();}
$('.author_wrapper').find('img:not(.js_processed)').addClass('js_processed').floatUserInfo();$('.namecard:not(.js_processed)').addClass('js_processed').floatUserInfo();if(response.show_login){showLoginWin();}}
else{}});};container.check=function(){if(true==container.processing)return;if(true==container.finish)return;clearTimeout(container.timer);container.timer=null;if($(document).scrollTop()*2>document.body.clientHeight){container.loadMore();}
else{container.timer=setTimeout(container.check,options.checkInterval);}};container.bindHover=function(){$(container).find('.'+options.posterClass+':not(.posterize_js_processed)').hover(function(){$(this).addClass(options.posterHoverClass);},function(){$(this).removeClass(options.posterHoverClass);}).addClass('posterize_js_processed');};container.processing=false;container.timer=null;container.finish=false;container.params=options.params;var $spinner=$(options.spinnerHtml);if(null!=options.uniqueKey){container.uniqueIds=[];}
if(null!=options.pagerWrapper){container.pagerWrapper=$(container).find(options.pagerWrapper).get(0);}
var cols=$(container).find('.'+options.columnClass.replace(' ','.'));container.colsHeight=[];container.cols=[];if(cols.length==0){container.cols=[];var i=0;while(i<options.column){container.cols[i]=$('<div class="'+options.columnClass+'"></div>');container.colsHeight[i]=0;i++;}
$.each(container.cols,function(i){$(container).append(container.cols[i]);});}
else{$.each(cols,function(i){container.cols[i]=$(cols[i]);container.colsHeight[i]=container.cols[i].height();});container.bindHover();}
$spinner.hide();$(container).append($spinner);if(options.initLoad){container.loadMore();}
else{container.check();}});}});Array.prototype.min_key=function(){var key=0,i=1,len=this.length;if(0==len)return false;while(i<len){if(this[i]<this[key]){key=i;}
i++;}
return key;};Array.prototype.swap=function(a,b){var tmp=this[a];this[a]=this[b];this[b]=tmp;};Array.prototype.partition=function(begin,end,pivot){var piv=this[pivot];this.swap(pivot,end-1);var store=begin;var ix;for(ix=begin;ix<end-1;++ix){if(this[ix]<=piv){this.swap(store,ix);++store;}}
this.swap(end-1,store);return store;};Array.prototype.qsort=function(begin,end){if(end-1>begin){var pivot=begin+Math.floor(Math.random()*(end-begin));pivot=this.partition(begin,end,pivot);this.qsort(begin,pivot);this.qsort(pivot+1,end);}};Array.prototype.find=function(num,begin,end){if(null==begin)begin=0;if(null==end)end=this.length-1;var middle=begin+Math.floor((end-begin)/2);if(this[begin]==num)return begin;if(this[end]==num)return end;if(this[middle]==num)return middle;if(begin==end)return false;if(this[middle]<num)return this.find(num,middle,end);if(this[middle]>num)return this.find(num,begin,middle);};})(jQuery);ua=navigator.userAgent.toLowerCase();isIE6=ua.indexOf("msie 6")>-1;(function($){$.extend({Poster:{load:function(opts,cbk){p_default={url:false,page:0,frame:0,$pager:$('.poster_pager'),$pinnable:$('.pinnable')};options=$.extend({},p_default,opts);var callback=function(response){response=$.JSON.decode(response);if(response.status){var top=false;if(response.posters){$.Poster.pin(options.$pinnable,response.posters,top);}
if(response.finish){options.$pager.html(response.pager);}}
if('function'==typeof cbk){cbk(response);}};var data={page:options.page,frame:options.frame};$.post(options.url,data,callback);},pin:function(container_selector,posters,top){var $containers=$(container_selector);var slots_bottom_line=[];$containers.each(function(index,e){var column=$(this);var position=column.offset();slots_bottom_line[index]=column.height()+position.top;});$(posters).each(function(index,e){var $e=$(e);if(top){$($containers[index%3]).prepend($e);}
else{var shortest=slots_bottom_line.min_key();$($containers[shortest]).append($e);}
slots_bottom_line[shortest]+=$e.height();});if(!isIE6){$('.comm_box').elastic();}},relocate:function(container_selector,poster_selector){var $containers=$(container_selector);var slots_bottom_line=[];var posters=$(container_selector+' > '+poster_selector);posters.remove();$containers.each(function(index,e){var position=$(this).offset();slots_bottom_line[index]=$(this).height()+position.top;});$(posters).each(function(index,e){var shortest=slots_bottom_line.min_key();var $e=$(e);$($containers[shortest]).append($e);slots_bottom_line[shortest]+=$e.height();});}}});Array.prototype.min_key=function(){var key=0,i=1,len=this.length;if(0==len)return false;while(i<len){if(this[i]<this[key]){key=i;}
i++;}
return key;};})(jQuery);function showCommentBox(cmtid,obj){if(current_user_id==0||current_user_id==''){showLoginWin();return false;}
else if(Meilishuo.config.is_actived==2){location.href=server_url+'users/activate_message';return false;}
var id=cmtid.substring(3,cmtid.length);var $father=obj.closest('.hp_top');$father.find('.hp_cmt').toggle('fast');return false;}
function hp_pic_mouse_over(obj){$(obj).find('.close').removeClass('none');$(obj).find('.group_name').show();}
function hp_pic_mouse_out(obj){$(obj).find('.close').addClass('none');$(obj).find('.group_name').hide();}
function deletePoster(obj){var parentNode=$(obj).closest('.h_poster');var tid=parentNode.find('.twitter_id').val();var t_user_id=parentNode.find('.twitter_author_id').val();var twitter_author_nickname=parentNode.find('.twitter_author_nickname').val();var twitter_author_avatar=parentNode.find('.twitter_author_avatar').val();var twitter_author_follower_num=parentNode.find('.twitter_author_follower_num').val();var twitter_author_twitter_num=parentNode.find('.twitter_author_twitter_num').val();var twitter_author_heart_num=parentNode.find('.twitter_author_heart_num').val();if(t_user_id==Meilishuo.current_user.id){show_confirm_delete(tid);}
else{var contentCode=$('<div class="poster_pop"><p>'+twitter_author_nickname+' 不是你的菜？</p><p>你可以取消对她的关注，以便不再接收她的动态。</p><div class="p_info mt10"><a class="avatar32" href="/person/u/'+t_user_id+'" target="_blank"><img src="'+twitter_author_avatar+'" /></a><p><a class="red" href="/person/u/'+t_user_id+'" target="_blank">'+twitter_author_nickname+'</a></p><p>粉丝<span class="red">'+twitter_author_follower_num+'</span>美丽说<span class="red">'+twitter_author_twitter_num+'</span><span class="heart red">'+twitter_author_heart_num+'</span></p></div><div class="btnBox"><span class="new_notfollow al cursor">取消关注</span><span class="next_say cursor">下次再说</span></div></div>');var init_dialog=$.dialog({title:'不再接收她的动态',content:contentCode,closeHandle:function(){init_dialog.remove();}});var confirm_btn=contentCode.find('.new_notfollow');var cancel_btn=contentCode.find('.next_say');confirm_btn.click(function(){var url='/twitter/ajax_moveFollower';var data={'fuid':t_user_id};var callback=function(response){init_dialog.remove();$('.u_'+t_user_id).remove();};$.get(url,data,callback);return false;});cancel_btn.click(function(){init_dialog.remove();});var ua=navigator.userAgent.toLowerCase();var isIE6=ua.indexOf("msie 6")>-1;var fixed=isIE6?'':'fixed';if(typeof(twitter_author_nickname)!='undefined'){init_dialog.toCenter(fixed).show();}}}
(function(jQuery){jQuery.fn.extend({elastic:function(){var mimics=['paddingTop','paddingRight','paddingBottom','paddingLeft','fontSize','lineHeight','fontFamily','width','fontWeight','border-top-width','border-right-width','border-bottom-width','border-left-width','borderTopStyle','borderTopColor','borderRightStyle','borderRightColor','borderBottomStyle','borderBottomColor','borderLeftStyle','borderLeftColor'];return this.each(function(){if(this.type!=='textarea'){return false;}
var $textarea=jQuery(this),$twin=jQuery('<div />').css({'position':'absolute','display':'none','word-wrap':'break-word'}),lineHeight=parseInt($textarea.css('line-height'),10)||parseInt($textarea.css('font-size'),'10'),minheight=parseInt($textarea.css('height'),10)||lineHeight*3,maxheight=parseInt($textarea.css('max-height'),10)||Number.MAX_VALUE,goalheight=0;if(maxheight<0){maxheight=Number.MAX_VALUE;}
$twin.appendTo($textarea.parent());var i=mimics.length;while(i--){$twin.css(mimics[i].toString(),$textarea.css(mimics[i].toString()));}
function setTwinWidth(){curatedWidth=Math.floor(parseInt($textarea.width(),10));if($twin.width()!==curatedWidth){$twin.css({'width':curatedWidth+'px'});update(true);}}
function setHeightAndOverflow(height,overflow){var curratedHeight=Math.floor(parseInt(height,10));if($textarea.height()!==curratedHeight){$textarea.css({'height':curratedHeight+'px','overflow':overflow});$textarea.trigger('resize');}}
function update(forced){var textareaContent=$textarea.val().replace(/&/g,'&amp;').replace(/ {2}/g,'&nbsp;').replace(/<|>/g,'&gt;').replace(/\n/g,'<br />');var twinContent=$twin.html().replace(/<br>/ig,'<br />');if(forced||textareaContent+'&nbsp;'!==twinContent){$twin.html(textareaContent+'&nbsp;');if(Math.abs($twin.height()+lineHeight-$textarea.height())>3){var goalheight=$twin.height()+lineHeight;if(goalheight>=maxheight){setHeightAndOverflow(maxheight,'auto');}else if(goalheight<=minheight){setHeightAndOverflow(minheight,'hidden');}else{setHeightAndOverflow(goalheight,'hidden');}}}}
$textarea.css({'overflow':'hidden'});$textarea.bind('keyup change cut paste',function(){update();});$(window).bind('resize',setTwinWidth);$textarea.bind('resize',setTwinWidth);$textarea.bind('update',update);$textarea.bind('blur',function(){if($twin.height()<maxheight){if($twin.height()>minheight){$textarea.height($twin.height());}else{$textarea.height(minheight);}}});$textarea.bind('input paste',function(e){setTimeout(update,250);});update();});}});})(jQuery);