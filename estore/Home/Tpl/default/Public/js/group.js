$.extend({dialog:function(options){var $d=$('<div class="dialog" id="dialog"></div>');if(typeof(options.width)=='undefined'){options.width='400px';}
if(options.closeHandle==null){options.closeHandle=function(){$d.remove();}}
var $closeButton=$('<div class="close_z r"></div>');$closeButton.click(options.closeHandle);if(options.title!=null){var $title=$('<div class="title">'+options.title+'</div>');$title.prepend($closeButton);}
var $content=$('<div class="content"></div>').append(options.content);$d.append($('<div class="wrapper"></div>').append($title).append($content)).css('width',options.width);$title.prepend($closeButton);$d.hide().appendTo('body');if(options.fixed=='fixed'){$d.toCenter(options.fixed);}
else{$d.toCenter();}
return $d;}});jQuery.imgAreaSelect={onKeyPress:null};jQuery.imgAreaSelect.init=function(img,options){var $area=jQuery('<div></div>'),$border1=jQuery('<div></div>'),$border2=jQuery('<div></div>'),$outLeft=jQuery('<div></div>'),$outTop=jQuery('<div></div>'),$outRight=jQuery('<div></div>'),$outBottom=jQuery('<div></div>'),left,top,imgOfs,imgWidth,imgHeight,parent,parOfs,parScroll,adjusted,zIndex=0,fixed,$p,startX,startY,moveX,moveY,resizeMargin=10,resize=[],V=0,H=1,keyDown,d,aspectRatio,x1,x2,y1,y2,x,y,selection={x1:0,y1:0,x2:0,y2:0,width:0,height:0};var $a=$area.add($border1).add($border2);var $o=$outLeft.add($outTop).add($outRight).add($outBottom);function viewX(x){return x+imgOfs.left+parScroll.left-parOfs.left}
function viewY(y){return y+imgOfs.top+parScroll.top-parOfs.top}
function selX(x){return x-imgOfs.left-parScroll.left+parOfs.left}
function selY(y){return y-imgOfs.top-parScroll.top+parOfs.top}
function evX(event){return event.pageX+parScroll.left-parOfs.left}
function evY(event){return event.pageY+parScroll.top-parOfs.top}
function adjust(){imgOfs=jQuery(img).offset();imgWidth=jQuery(img).width();imgHeight=jQuery(img).height();if(jQuery(parent).is('body'))
parOfs=parScroll={left:0,top:0};else{parOfs=jQuery(parent).offset();parScroll={left:parent.scrollLeft,top:parent.scrollTop}}
left=viewX(0);top=viewY(0)}
function update(resetKeyPress){$a.css({left:viewX(selection.x1)+'px',top:viewY(selection.y1)+'px',width:Math.max(selection.width-options.borderWidth*2,0)+'px',height:Math.max(selection.height-options.borderWidth*2,0)+'px'});$outLeft.css({left:left+'px',top:top+'px',width:selection.x1+'px',height:imgHeight+'px'});$outTop.css({left:left+selection.x1+'px',top:top+'px',width:selection.width+'px',height:selection.y1+'px'});$outRight.css({left:left+selection.x2+'px',top:top+'px',width:imgWidth-selection.x2+'px',height:imgHeight+'px'});$outBottom.css({left:left+selection.x1+'px',top:top+selection.y2+'px',width:selection.width+'px',height:imgHeight-selection.y2+'px'});if(resetKeyPress!==false){if(jQuery.imgAreaSelect.keyPress!=docKeyPress)
jQuery(document).unbind(jQuery.imgAreaSelect.keyPress,jQuery.imgAreaSelect.onKeyPress);if(options.keys)
jQuery(document).bind(jQuery.imgAreaSelect.keyPress,jQuery.imgAreaSelect.onKeyPress=docKeyPress)}}
function areaMouseMove(event){if(!adjusted){adjust();adjusted=true;$a.one('mouseout',function(){adjusted=false})}
x=selX(evX(event))-selection.x1;y=selY(evY(event))-selection.y1;resize=[];if(options.resizable){if(y<=resizeMargin)
resize[V]='n';else if(y>=selection.height-resizeMargin)
resize[V]='s';if(x<=resizeMargin)
resize[H]='w';else if(x>=selection.width-resizeMargin)
resize[H]='e'}
$border2.css('cursor',resize.length?resize.join('')+'-resize':options.movable?'move':'')}
function areaMouseDown(event){if(event.which!=1)
return false;adjust();if(options.resizable&&resize.length>0){jQuery('body').css('cursor',resize.join('')+'-resize');x1=viewX(resize[H]=='w'?selection.x2:selection.x1);y1=viewY(resize[V]=='n'?selection.y2:selection.y1);jQuery(document).mousemove(selectingMouseMove);$border2.unbind('mousemove',areaMouseMove);jQuery(document).one('mouseup',function(){resize=[];jQuery('body').css('cursor','');if(options.autoHide)
$a.add($o).hide();options.onSelectEnd(img,selection);jQuery(document).unbind('mousemove',selectingMouseMove);$border2.mousemove(areaMouseMove)})}else if(options.movable){moveX=selection.x1+left;moveY=selection.y1+top;startX=evX(event);startY=evY(event);jQuery(document).mousemove(movingMouseMove).one('mouseup',function(){options.onSelectEnd(img,selection);jQuery(document).unbind('mousemove',movingMouseMove)})}else
jQuery(img).mousedown(event);return false}
function aspectRatioXY(){x2=Math.max(left,Math.min(left+imgWidth,x1+Math.abs(y2-y1)*aspectRatio*(x2>=x1?1:-1)));y2=Math.round(Math.max(top,Math.min(top+imgHeight,y1
+Math.abs(x2-x1)/aspectRatio*(y2>=y1?1:-1))));x2=Math.round(x2)}
function aspectRatioYX(){y2=Math.max(top,Math.min(top+imgHeight,y1+Math.abs(x2-x1)/aspectRatio*(y2>=y1?1:-1)));x2=Math.round(Math.max(left,Math.min(left+imgWidth,x1
+Math.abs(y2-y1)*aspectRatio*(x2>=x1?1:-1))));y2=Math.round(y2)}
function doResize(newX2,newY2){x2=newX2;y2=newY2;if(options.minWidth&&Math.abs(x2-x1)<options.minWidth){x2=x1-options.minWidth*(x2<x1?1:-1);if(x2<left)
x1=left+options.minWidth;else if(x2>left+imgWidth)
x1=left+imgWidth-options.minWidth}
if(options.minHeight&&Math.abs(y2-y1)<options.minHeight){y2=y1-options.minHeight*(y2<y1?1:-1);if(y2<top)
y1=top+options.minHeight;else if(y2>top+imgHeight)
y1=top+imgHeight-options.minHeight}
x2=Math.max(left,Math.min(x2,left+imgWidth));y2=Math.max(top,Math.min(y2,top+imgHeight));if(aspectRatio)
if(Math.abs(x2-x1)/aspectRatio>Math.abs(y2-y1))
aspectRatioYX();else
aspectRatioXY();if(options.maxWidth&&Math.abs(x2-x1)>options.maxWidth){x2=x1-options.maxWidth*(x2<x1?1:-1);if(aspectRatio)
aspectRatioYX()}
if(options.maxHeight&&Math.abs(y2-y1)>options.maxHeight){y2=y1-options.maxHeight*(y2<y1?1:-1);if(aspectRatio)
aspectRatioXY()}
selection.x1=selX(Math.min(x1,x2));selection.x2=selX(Math.max(x1,x2));selection.y1=selY(Math.min(y1,y2));selection.y2=selY(Math.max(y1,y2));selection.width=Math.abs(x2-x1);selection.height=Math.abs(y2-y1);update();options.onSelectChange(img,selection)}
function selectingMouseMove(event){x2=!resize.length||resize[H]||aspectRatio?evX(event):viewX(selection.x2);y2=!resize.length||resize[V]||aspectRatio?evY(event):viewY(selection.y2);doResize(x2,y2);return false}
function doMove(newX1,newY1){x2=(x1=newX1)+selection.width;y2=(y1=newY1)+selection.height;selection.x1=selX(x1);selection.y1=selY(y1);selection.x2=selX(x2);selection.y2=selY(y2);update();options.onSelectChange(img,selection)}
function movingMouseMove(event){var newX1=Math.max(left,Math.min(moveX+evX(event)-startX,left
+imgWidth-selection.width));var newY1=Math.max(top,Math.min(moveY+evY(event)-startY,top
+imgHeight-selection.height));doMove(newX1,newY1);event.preventDefault();return false}
function startSelection(event){adjust();selection.x1=selection.x2=selX(startX=x1=x2=evX(event));selection.y1=selection.y2=selY(startY=y1=y2=evY(event));selection.width=0;selection.height=0;resize=[];update();$a.add($o).show();jQuery(document).unbind('mouseup',cancelSelection).mousemove(selectingMouseMove);$border2.unbind('mousemove',areaMouseMove);options.onSelectStart(img,selection);jQuery(document).one('mouseup',function(){if(options.autoHide||(selection.width*selection.height==0))
$a.add($o).hide();options.onSelectEnd(img,selection);jQuery(document).unbind('mousemove',selectingMouseMove);$border2.mousemove(areaMouseMove)})}
function cancelSelection(){jQuery(document).unbind('mousemove',startSelection);$a.add($o).hide()}
function imgMouseDown(event){if(event.which!=1)
return false;jQuery(document).one('mousemove',startSelection).one('mouseup',cancelSelection);return false}
function windowResize(){adjust();update(false);x1=viewX(selection.x1);y1=viewY(selection.y1);x2=viewX(selection.x2);y2=viewY(selection.y2)}
var docKeyPress=function(event){var k=options.keys,d=10,t,key=event.keyCode||event.which;if(!isNaN(k.arrows))
d=k.arrows;if(!isNaN(k.shift)&&event.shiftKey)
d=k.shift;if(!isNaN(k.ctrl)&&event.ctrlKey)
d=k.ctrl;if(!isNaN(k.alt)&&(event.altKey||event.originalEvent.altKey))
d=k.alt;if(k.arrows=='resize'||(k.shift=='resize'&&event.shiftKey)||(k.ctrl=='resize'&&event.ctrlKey)||(k.alt=='resize'&&(event.altKey||event.originalEvent.altKey))){switch(key){case 37:d=-d;case 39:t=Math.max(x1,x2);x1=Math.min(x1,x2);x2=Math.max(t+d,x1);if(aspectRatio)
aspectRatioYX();break;case 38:d=-d;case 40:t=Math.max(y1,y2);y1=Math.min(y1,y2);y2=Math.max(t+d,y1);if(aspectRatio)
aspectRatioXY();break;default:return}
doResize(x2,y2)}else{x1=Math.min(x1,x2);y1=Math.min(y1,y2);switch(key){case 37:doMove(Math.max(x1-d,left),y1);break;case 38:doMove(x1,Math.max(y1-d,top));break;case 39:doMove(x1+Math.min(d,imgWidth-selX(x2)),y1);break;case 40:doMove(x1,y1+Math.min(d,imgHeight-selY(y2)));break;default:return}}
return false};this.setOptions=function(newOptions){options=jQuery.extend(options,newOptions);if(newOptions.x1!=null){selection.x1=newOptions.x1;selection.y1=newOptions.y1;selection.x2=newOptions.x2;selection.y2=newOptions.y2;newOptions.show=true}
if(newOptions.keys)
options.keys=jQuery.extend({shift:1,ctrl:'resize'},newOptions.keys===true?{}:newOptions.keys);parent=jQuery(options.parent).get(0);adjust();$p=jQuery(img);while($p.length&&!$p.is('body')){if(!isNaN($p.css('z-index'))&&$p.css('z-index')>zIndex)
zIndex=$p.css('z-index');if($p.css('position')=='fixed')
fixed=true;$p=$p.parent()}
x1=viewX(selection.x1);y1=viewY(selection.y1);x2=viewX(selection.x2);y2=viewY(selection.y2);selection.width=x2-x1;selection.height=y2-y1;update();if(newOptions.hide)
$a.add($o).hide();else if(newOptions.show)
$a.add($o).show();$o.addClass(options.classPrefix+'-outer');$area.addClass(options.classPrefix+'-selection');$border1.addClass(options.classPrefix+'-border1');$border2.addClass(options.classPrefix+'-border2');$a.css({borderWidth:options.borderWidth+'px'});$area.css({backgroundColor:options.selectionColor,opacity:options.selectionOpacity});$border1.css({borderStyle:'solid',borderColor:options.borderColor1});$border2.css({borderStyle:'dashed',borderColor:options.borderColor2});$o.css({opacity:options.outerOpacity,backgroundColor:options.outerColor});aspectRatio=options.aspectRatio&&(d=options.aspectRatio.split(/:/))?d[0]/d[1]:null;if(options.disable||options.enable===false){$a.unbind('mousemove',areaMouseMove).unbind('mousedown',areaMouseDown);jQuery(img).add($o).unbind('mousedown',imgMouseDown);jQuery(window).unbind('resize',windowResize)}else if(options.enable||options.disable===false){if(options.resizable||options.movable)
$a.mousemove(areaMouseMove).mousedown(areaMouseDown);if(!options.persistent)
jQuery(img).add($o).mousedown(imgMouseDown);jQuery(window).resize(windowResize)}
jQuery(options.parent).append($o.add($a));options.enable=options.disable=undefined};if(jQuery.browser.msie)
jQuery(img).attr('unselectable','on');jQuery.imgAreaSelect.keyPress=jQuery.browser.msie||jQuery.browser.safari?'keydown':'keypress';$a.add($o).css({display:'none',position:fixed?'fixed':'absolute',overflow:'hidden',zIndex:zIndex>0?zIndex:'0'});$area.css({borderStyle:'solid'});initOptions={borderColor1:'#000',borderColor2:'#fff',borderWidth:1,classPrefix:'imgareaselect',movable:true,resizable:true,selectionColor:'#fff',selectionOpacity:0.2,outerColor:'#000',outerOpacity:0.2,parent:'body',onSelectStart:function(){},onSelectChange:function(){},onSelectEnd:function(){}};options=jQuery.extend(initOptions,options);this.setOptions(options)};jQuery.fn.imgAreaSelect=function(options){options=options||{};this.each(function(){if(jQuery(this).data('imgAreaSelect'))
jQuery(this).data('imgAreaSelect').setOptions(options);else{if(options.enable===undefined&&options.disable===undefined)
options.enable=true;jQuery(this).data('imgAreaSelect',new jQuery.imgAreaSelect.init(this,options))}});return this};function copyLink(){var clip=new ZeroClipboard.Client();ZeroClipboard.setMoviePath(server_url+'css/ZeroClipboard.swf');var html=clip.getHTML(150,20);document.write(html);var link=$("#invite_link").val();clip.setText(link);clip.glue('d_clip_button','next_step_box');}
function checkRealnameForm(){var realname=$.trim($('#realname').val());if(realname.length==0){$('#realname_panel .hint').text('不能为空').show();return false;}
return true;}
function showBindPanel(type,obj){var getSettings=function(){$.ajax({async:false,type:"POST",url:'/settings/ajax_getSyncSettings',data:{'type':type},success:function(data){var settings=data.split(',');if(settings.length>=5){$('#syncForm :checkbox').attr('checked','');if(settings[0]==1){$('#chk_goods').attr('checked','checked');}
if(settings[1]==1){$('#chk_collect').attr('checked','checked');}
if(settings[2]==1){$('#chk_like').attr('checked','checked');}
if(settings[3]==1){$('#chk_ask').attr('checked','checked');}
if(settings[4]==1){$('#chk_answer').attr('checked','checked');}}
$('#setting_type').val(type);var o=$(obj);var offset=o.offset();$('#setting_panel').css({left:offset.left+o.width()+50,top:offset.top-110}).show();}});};if(type!='renren'||renren_allow_publish_feed){getSettings();}else{if(XN.Connect==null){setTimeout(function(){showBindPanel('renren',obj);},1000);return;}
XN.Connect.requireSession(function(){XN.Connect.showPermissionDialog('publish_feed',function(result){if(result){renren_allow_publish_feed=true;getSettings();}else{alert('允许授权后才可以使用同步新鲜事功能');}});});}}
function syncBind(type){if(type=='renren'&&renren_allow_publish_feed==false){XN.Connect.requireSession(function(){XN.Connect.showPermissionDialog('publish_feed',function(result){if(result){location.href='/settings/syncBind/renren';}else{alert('允许授权后才可以使用同步新鲜事功能');}});});}else if(type=='weibo'){var follow='';follow=$('#follow-mls').attr('checked')?1:0;location.href='/settings/syncBind/'+type+'?follow='+follow;}else{location.href='/settings/syncBind/'+type;}
return false;}
function syncUnBind(type){if(confirm('你确定要解除绑定吗？')){location.href='/settings/syncUnBind/'+type;}
return false;}
function checktradeid(){var trade_id=$('#trade_id').val().trim();var re=/^[0-9]+.?[0-9]*$/;if(trade_id==''||!re.test(trade_id)){alert('请填写正确的交易号！');return false;}
return true;}
function zhifubao(){var alipay=$('#alipay').val().trim();var taobaoid=$('#taobao_id').val().trim();if(alipay==''){$('#account-hint').html('支付宝账号不能为空！');return false;}
if(taobaoid==''){$('#account-hint').html('淘宝账户名不能为空！');return false;}
var url=server_url+'/settings/ajax_setBenefitAction';var data={'alipay':alipay,'taobao_id':taobaoid};var callback=function(r){if(r==1){$('#account-hint').html('修改成功！');}else{$('#account-hint').html('你已经保存成功了！');}}
$.post(url,data,callback);}
function getcash(){var alipay=$('#alipay').val().trim();var taobaoid=$('#taobao_id').val().trim();var realname=$('#realname').val().trim();if(alipay==''){$('#account-hint').html('支付宝账号不能为空！');return false;}
if(taobaoid==''){$('#account-hint').html('淘宝账户名不能为空！');return false;}
if(realname==''){$('#account-hint').html('真实姓名不能为空！');return false;}
return true;}
function syncSubmit(){$('#syncForm').ajaxSubmit({success:function(data){alert(data);}});return false;}
var $applyWindow=null;function showApplyWindow(tid,gid){if($applyWindow==null){$applyWindow=$.dialog({title:'填写交易信息',content:$('#pop_apply_content').show(),closeHandle:function(){$(this).closest('.dialog').hide();}});}
$('#twitter_id').val(tid);$('#goods_id').val(gid);$('#trade_id').val('');var $img=$('#t'+tid+' .goods_pic');var imgSrc=$img.attr('src');var goodsTitle=$img.attr('alt');var url='{/$BASE_URL/}person/showTwitterPage?t='+tid;$applyWindow.find('.pic').attr('href',url).find('img').attr('src',imgSrc);$applyWindow.find('.goods_title').attr('href',url).text(goodsTitle);$applyWindow.toCenter().show();$('#trade_id').focus();}
function postApplyForm(url,data,type){var trade_id=$.trim($('#trade_id').val());if(trade_id==''){alert('交易号不能为空');return false;}
data.trade_id=trade_id;$.post(url,data,function(data){if(data=='1'){if(type==1){$('.dialog').hide();var closeFunc=function(){location.href=location.href;};$('#pop_apply_finish .ok').click(closeFunc);$.dialog({title:'美丽提示',content:$('#pop_apply_finish').show(),closeHandle:closeFunc}).toCenter().show();showShadow();}else{location.href=location.href;}}else{alert(data);}});}
function addApply(tid,gid){showApplyWindow(tid,gid);$('#pop_apply_content').find('.submit').unbind('click').click(function(){postApplyForm('/commission/ajax_addApply',{'tid':tid,'gid':gid},1);});}
function updateApply(applyId,tid,gid){showApplyWindow(tid,gid);$('#pop_apply_content').find('.submit').unbind('click').click(function(){postApplyForm('/commission/ajax_updateApply',{'apply_id':applyId},2);});}
function reSubmitApply(applyId,tid,gid){showApplyWindow(tid,gid);$('#pop_apply_content').find('.submit').unbind('click').click(function(){postApplyForm('/commission/ajax_reSubmitApply',{'apply_id':applyId},3);});}
$(function(){$('#taobao_id_update').click(function(){$('#discount_stat').hide();$('#pay_info').show();$('#taobao_id').focus();});$('#alipay_update').click(function(){$('#discount_stat').hide();$('#pay_info').show();$('#alipay').focus();});$('#realname_update').click(function(){$('#discount_stat').hide();$('#pay_info').show();$('#alipay').focus();});$('#payme').click(function(){$(this).hide().after('...');$.post('/commission/ajax_payme',{},function(data){if(data==''){$.dialog({title:'美丽提示',content:$('#pop_payme').show(),closeHandle:function(){location.href=location.href;}}).toCenter().show();}else{alert(data);location.href=location.href;}});});});var Group=Group||{group_id:0,group_name:'',last_twitter_id:0,current_uid:current_user_id,page:0,elite:0,sort:0,is_member:false,is_admin:false,is_blocked:false,is_follow:false,locate:'',message:'',is_applying:false};Group.acl_check=function(){if(Group.current_uid==0||Group.current_uid==''){showLoginWin();return{'status':false};}
else if(Group.is_member==false){return{'status':false,'message':Group.message};}
return{'status':true};};Group.load_twitter=function(){window.location='/'+Group.locate+'/'+Group.group_id+'?poster=0&sort=1';return;};Group.load_topic_twitter=function(){window.location='/'+Group.locate+'/'+Group.group_id+'?poster=0&topic_id='+Group.topic_id;return;};Group.load_poster=function(){window.location='/'+Group.locate+'/'+Group.group_id+'?poster=1';return;};var $group_pop=$('<div><p>加入杂志社后才能发言哦，是否加入？</p><a class="red c f14" href="group/'+Group.group_id+'/join">加入杂志社</a></div>');var $group_pop1=$('<div><a class="red c f14">现在还不能发言哦～～请耐心等待主编通过您的申请</a></div>');Group.follow=function(){var $e=$(this);var $count_member_number=$('.count_member_number');$e.unbind('click').click(function(){return false;});var url=server_url+'group/'+Group.group_id+'/follow';var data={'ajax':1,'sort':Group.sort};var callback=function(response){response=$.JSON.decode(response);if(response.status){if(response.follow==true){$e.removeClass('g_join').addClass('g_exit red c f14').html('已关注');if(Group.is_follow==false)
$count_member_number.html(parseInt($count_member_number.html())+1);else
Group.is_follow=true;$e.attr('href','/group/'+Group.group_id+'/quit');$e.click(Group.quit);$('#follow_done').fadeIn(500);t=setTimeout("$('#follow_done').fadeOut(500)",3000);$e.mouseover(function(){$(this).html('取消关注');});$e.mouseout(function(){if(Group.is_member==false)
$(this).html('已关注');else
$(this).html('已加入');});}}
else{$e.unbind('click').click(Group.join);if(Group.is_blocked==true){alert('您已被该杂志社屏蔽');}
else{showLoginWin();}}};$.post(url,data,callback);return false;};Group.join=function(){var $e=$(this);$e.unbind('click').click(function(){return false;});var $count_member_number=$('.count_member_number');var url=server_url+'group/'+Group.group_id+'/join';var data={'ajax':1,'sort':Group.sort};var callback=function(response){response=$.JSON.decode(response);if(response.status){if(response.applying==true){Group.is_applying=true;if(Group.is_follow==false){$('.g_join').removeClass('g_join').addClass('g_exit red').html('已关注');$count_member_number.html(parseInt($count_member_number.html())+1);}
Group.is_follow=true;$('#join').removeClass('red r_join red c f14"').addClass('red r_exit red c f14"').html('已申请加入');$('.g_join').mouseover(function(){$(this).html('取消关注');});$('.g_join').mouseout(function(){$(this).html('已关注');});}
else{Group.is_member=true;$count_member_number.html(parseInt($count_member_number.html())+1);$e.attr('href','/group/'+Group.group_id+'/quit');$e.unbind('click').click(Group.quit);$e.html('已加入');$('.g_join').removeClass('g_join').addClass('g_exit red').html('已关注');$e.mouseover(function(){$(this).html('取消关注');});$e.mouseout(function(){$(this).html('已关注');});}}
else{$e.unbind('click').click(Group.join);if(Group.is_blocked==true){alert('您已被该杂志社屏蔽');}
else{showLoginWin();}}};$.post(url,data,callback);return false;};Group.quit=function(){var $e=$(this);var $count_member_number=$('.count_member_number');if(Group.is_admin==true){alert("您现在是主编，您不能退出杂志社。");return false;}
else{if(Group.is_member==true){var c=confirm("您确定要退出该杂志社吗?")}
else if(Group.is_follow==true){var c=confirm("您确定要取消关注该杂志社?")}
if(c==false){return false;}
var url=server_url+'group/'+Group.group_id+'/quit';var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);if(response.status){Group.is_member=false;$count_member_number.html(parseInt($count_member_number.html())-1);$e.attr('href','/group/'+Group.group_id+'/follow');$e.click(Group.follow);$('#join').removeClass('red r_exit red c f14').addClass('red r_join red c f14').html('加入杂志社');$('#join').attr('href','/group/'+Group.group_id+'/join');$('.g_exit').removeClass('g_exit red').addClass('g_join').html('+加关注');$e.unbind('mouseover').unbind('mouseout');}
else{$e.unbind('click').click(Group.quit);}};$.post(url,data,callback);}
return false;};Group.show_editor=function(){var $e=$(this);var $editor=$('#twitter_editor');var $toggle_picture=$editor.find('.toggle_picture');var offset=$toggle_picture.offset();var $upload_handle=$editor.find('.upload_file');$upload_handle.css({'top':offset.top+20,'left':offset.left-33});$editor.show();console.log($upload_handle);$e.unbind('click').click(Group.hide_editor);};Group.hide_editor=function(){var $e=$(this);var $editor=$('#twitter_editor');$editor.slideUp();$e.unbind('click').click(Group.show_editor);};Group.set_elite=function(){var $e=$(this);var $stamp=$e.parents('.twitter_r').find('.jing');if($stamp.length==0){$stamp=$('<div>').addClass('jing').hide();$stamp.appendTo($e.parents('.twitter_r'));}
var url=$(this).attr('href');var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);$stamp.show();$e.attr('href',response.url);$e.unbind('click').click(Group.remove_elite);$e.removeClass('.elite').addClass('.remove_elite').html('取消加精');};if(Group.set_elite_alert()==true){$.post(url,data,callback);}
return false;};Group.poster_set_elite=function(){var $e=$(this);var url=$(this).attr('href');var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);$e.attr('href',response.url);$e.unbind('click').click(Group.poster_remove_elite);$e.removeClass('p_elite').addClass('p_remove_elite').html('已加精');$e.hover(function(){$e.html('取消');},function(){$e.html('已加精');});};Group.p_set_elite_alert(url,data,callback,'post');return false;};Group.remove_elite=function(){var $e=$(this);var $stamp=$e.parents('.twitter_r').find('.jing');var url=$(this).attr('href');var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);$e.removeClass;$stamp.hide();$e.attr('href',response.url);$e.unbind('click').click(Group.set_elite);$e.removeClass('.remove_elite').addClass('.elite').html('加精');};if(Group.cancel_elite_alert()==true){$.get(url,data,callback);}
return false;};Group.poster_remove_elite=function(){var $e=$(this);var url=$(this).attr('href');var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);$e.attr('href',response.url);$e.unbind('click').click(Group.poster_set_elite);$e.removeClass('p_remove_elite').addClass('p_elite').html('<div class="p_set_jj"> </div>加精');$e.unbind('mouseenter').unbind('mouseleave');};Group.p_cancel_elite_alert(url,data,callback,'get');return false;}
Group.delete_twitter=function(){var $e=$(this);var $stamp=$e.parents('.g_twitter');var url=$(this).attr('href');var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);$e.removeClass;$stamp.hide();$e.unbind('click').click(Group.set_elite);};if(Group.delete_alert()==true){$.get(url,data,callback);}
return false;};Group.poster_delete_twitter=function(){var $e=$(this);var $stamp=$e.parents('.h_poster');var url=$(this).attr('href');var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);$e.removeClass;$stamp.hide();$e.unbind('click');};var admin=Group.admin_ids;var twitter_author_id=$(this).parents('.h_poster').find('input.twitter_author_id').val();if($.inArray(twitter_author_id,admin)==-1){Group.p_delete_alert(url,data,callback,'get');return false;}
else{Group.p_delete_alert1(url,data,callback,'get');return false;}};Group.twitter_pic_switch=function(){var $big=$(this).find('.pic_big');var $small=$(this).find('.pic_small');var $goods_title=$(this).siblings('.goods_title');var $view_larger=$(this).find('.view_larger');var $comment_box=$(this).closest('.twitter_r').siblings('.gt_comm').find('.comments');var toggle=function(){$big.toggle();$small.toggle();$goods_title.toggle();if($big.is(':visible')){$comment_box.show();}
else{$comment_box.hide();}
var $toggle_picture=$('#twitter_editor .toggle_picture');var $upload_form=$('#twitter_editor form');var $upload_handle=$upload_form.find('.upload_file');var offset=$toggle_picture.offset();$upload_handle.css({'top':offset.top+2,'left':offset.left-10});};$big.click(toggle);$small.click(toggle);$big.mouseover(function(){$view_larger.show();});$big.mouseout(function(){$view_larger.hide();});};Group.twitter_like=function(){var $e=$(this);var $count=$e.siblings('.count_like');if(current_user_id==0||current_user_id==''){showLoginWin();return false;}
$e.unbind('click');var tid=$(this).attr('tid');var aid=$(this).attr('aid');var url='/twitter/ajax_voteTwitter';var data={'tvd':tid,'str':'+1','tvy':1,'a_id':aid};var callback=function(response){response=$.JSON.decode(response);if(response.str=='+1'){$e.addClass('loveit').removeClass('notloveit');if(parseInt($count.html())==0){$count.show();}
$count.html(parseInt($count.html())+1);}
else if(response.str=='-1'){$e.addClass('notloveit').removeClass('loveit');if(parseInt($count.html())==1){$count.hide();}
$count.html(parseInt($count.html())-1);}
$e.click(Group.twitter_like);};$.post(url,data,callback);return false;};function applying_group(){if(current_user_id==0||current_user_id==''){showLoginWin();return false;}
var $e=$(this);var $name=$('#group_name').val();var $description=$('#group_description').val();var $reason=$('#reason').val();var $blogs=$('#blogs').val();var $phone_number=$('#phone_number').val();var $real_name=$('#real_name').val();var $address=$('#address').val();var $checked=$('#apply_share').attr('checked');if($name==''||$description==''||$reason==''||$blogs==''||$phone_number==''||$real_name==''||$address==''){$('#hint_message').html("<div class='f12' style='padding-left: 135px;'>请填写完整的*必填信息<div>");$('#hint_message').show();return false;}
var url=server_url+'group/ajax_checkIfGroupNameExist';var data={'name':$name};var $result=checkIfGroupNameExist($name);if($result==2){$('#hint_message').html("<div class='f12' style='padding-left: 135px;'> 抱歉,这个名字太受欢迎了,换个名字吧~~<div>");$('#hint_message').show();return false;}
if($checked==true){$sentence='我刚刚在 @美丽说 申请创办了自己的杂志社《'+$name+'》,即将开启我的主编之路。爱我的你们也来和我一起享受做主编的乐趣,做 最IN的时尚女魔头吧!'+'- http://www.meilishuo.com/group';shareGroupToWeibo($sentence);}
return true;};function checkIfGroupNameExist(name){if(current_user_id==0||current_user_id==''){showLoginWin();return false;}
var name=name;var url=server_url+'group/ajax_checkIfGroupNameExist';var data={'name':name};var r;var callback=function(result){r=result;};$.ajax({async:false,type:"POST",url:url,data:data,success:callback});return r;};function open_group(){if(current_user_id==0||current_user_id==''){showLoginWin();return false;}
var $e=$(this);var $name=$('#open_name').val();var $classify=$('#open_classify').val();var $description=$('#open_description').val();if($name==''||$classify==''){$('#hint_message').html("<div class='f12' style='padding-left: 135px;'>请填写完整的*必填信息<div>");$('#hint_message').show();return false;}
var $result=checkIfGroupNameExist($name);if($result==3){$('#hint_message').html("<div class='f12' style='padding-left: 135px;'>抱歉,名字里不可以使用特殊符号哦<div>");$('#hint_message').show();return false;}
else if($result==2){$('#hint_message').html("<div class='f12' style='padding-left: 135px;'>哎呀,这个名称已经有人使用了,请换个名称吧<div>");$('#hint_message').show();return false;}
shareGroupToWeibo($sentence);return true;}
function shareGroupToWeibo($sentence){var reply=$sentence;var imgsrc='';javascript:void((function(s,d,e){try{}catch(e){}
var f='http://v.t.sina.com.cn/share/share.php?',u='',p=['url=',e(u),'&title=',e(reply),'&appkey=463778370'].join('');if(imgsrc!==false){p+='&pic='+imgsrc;}
function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join(''))){u.href=[f,p].join('');}};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0);}else{a();}})(screen,document,encodeURIComponent));};function shareGroupToSinaWeibo($name,$picSrc,$groupId,$reply){var reply=$reply+'-'+server_url+'group/'+$groupId;var imgsrc=Meilishuo.config.picture_url+$picSrc;javascript:void((function(s,d,e){try{}catch(e){}
var f='http://v.t.sina.com.cn/share/share.php?',u='',p=['url=',e(u),'&title=',e(reply),'&appkey=463778370'].join('');if(imgsrc!==false){p+='&pic='+imgsrc;}
function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join(''))){u.href=[f,p].join('');}};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0);}else{a();}})(screen,document,encodeURIComponent));};function shareToQQWeiBo($name,$picSrc,$groupId,$reply){var reply=$reply;var imgsrc=Meilishuo.config.picture_url+$picSrc;var randNum=Math.random();var url=server_url+'group/'+$groupId+'?'+randNum;javascript:void((function(s,d,e){try{}catch(e){}
var f='http://v.t.qq.com/share/share.php?',u=url,p=['url=',e(u),'&title=',e(reply),'&appkey=95fd1cb5bf304d259fdaec43297d8b33'].join('');if(imgsrc!==false){p+='&pic='+imgsrc;}
function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join(''))){u.href=[f,p].join('');}};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0);}else{a();}})(screen,document,encodeURIComponent));};function shareGroupToQzone($name,$picSrc,$groupId,$reply,$description){var reply=$reply+'-'+server_url+'group/'+$groupId;var randNum=Math.random();var imgsrc=Meilishuo.config.picture_url+$picSrc;var qq_url=server_url+'group/'+$groupId+'?'+randNum;var description=$description;javascript:void((function(s,d,e){try{}catch(e){}
var f='http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?';var s={url:server_url+'group/'+$groupId+'?'+randNum,desc:reply,summary:description,title:'',site:'美丽说',pics:imgsrc};var p=[];for(var i in s){p.push(i+'='+e(s[i]||''));}
function a(){if(!window.open([f,p.join('&')].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join(''))){u.href=[f,p.join('&')].join('');}};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0);}else{a();}})(screen,document,encodeURIComponent));};Group.confirm_alert=function(title,content,url,data,callback,isGet){var contentCode=$('<div class="c group_pop_c"><p class="f14n">'+content+'</p><p class="mt14"><a class="btn_confirm qbi_sure cursor">确定</a><a class="btn_cancle cursor gray" style="margin-left: 10px;">取消</a></p></div>');var confirm_dialog=$.dialog({title:title,content:contentCode,closeHandle:function(){confirm_dialog.remove();}});contentCode.find('.btn_confirm').click(function(){data.check=$('#checkb').attr('checked');confirm_dialog.remove();if(isGet=='get'){$.get(url,data,callback);}
else if(isGet=='post'){$.post(url,data,callback);}
return false;});contentCode.find('.btn_cancle').click(function(){confirm_dialog.remove();});var ua=navigator.userAgent.toLowerCase();var isIE6=ua.indexOf("msie 6")>-1;var fixed=isIE6?'':'fixed';confirm_dialog.toCenter(fixed).show();};Group.p_delete_alert=function(url,data,callback,isGet){var title="删除内容";var content="确定删除该内容？"+"<br>"+'<input class="pr" style="top:2px" type="checkbox" id="checkb">'+'<span class="f12">将该用户踢出杂志社并删除其全部分享</span>';Group.confirm_alert(title,content,url,data,callback,isGet);};Group.p_delete_alert1=function(url,data,callback,isGet){var title="删除内容";var content="确定删除该内容？";Group.confirm_alert(title,content,url,data,callback,isGet);};Group.p_set_elite_alert=function(url,data,callback,isGet){var title="加为精华";var content="确定将该内容加为精华？";Group.confirm_alert(title,content,url,data,callback,isGet);};Group.p_cancel_elite_alert=function(url,data,callback,isGet){var title="取消精华";var content="确定取消该内容的精华？";Group.confirm_alert(title,content,url,data,callback,isGet);};Group.delete_alert=function(){var r=confirm("您确定要将该内容删除?");if(r==true){alert("已将该内容删除!");return true;}
else{return false;}};Group.set_elite_alert=function(){var r=confirm("您确定要将该内容加精?");if(r==true){alert("已将该内容加精!");return true;}
else{return false;}};Group.cancel_elite_alert=function(){var r=confirm("您确定要将该内容取消加精?");if(r==true){alert("已将该内容取消加精!");return true;}
else{return false;}}
function cancel_sticky_alert(){var r=confirm("您确定要将该内容取消置顶?");if(r==true){alert("已将该内容取消置顶!");return true;}
else{return false;}};function set_sticky_alert(){var r=confirm("您确定要将该内容置顶?");if(r==true){alert("已将该内容置顶!");return true;}
else{return false;}};Group.poster_ready=function(){var $posters=$('.h_poster').find('.hp_pic');var $dropdown=$('<div class="dropdown none"><div class="p_set_icon"></div><ul class="add_menu_leo none p_set_ul"><li><a class="p_delete_twitter" href=""><div class="p_set_sc"> </div>删除</a></li><li><a class="p_set_elite" href=""><div class="p_set_jj"> </div>加精</a></li></ul></div>');$posters.append($dropdown);$posters.each(function(){$e=$(this);$p=$e.parent().parent();var tid=$p.find('.twitter_id').val();var group_id=$p.find('.group_id').val();var url_del="/group/"+group_id+"/ajax_delete_all?twitter_id="+tid+"&page=";if(twitters_elite[tid]&1==1){var url_cancel="/group/"+group_id+"/ajax_cancel_elite?twitter_id="+tid+"&page=";$e.find('.p_set_elite').removeClass().addClass('p_remove_elite').attr('href',url_cancel).html('已加精');}
else{var url_elite="/group/"+group_id+"/ajax_set_elite?twitter_id="+tid+"&page=";$e.find('.p_set_elite').attr('href',url_elite);}
$e.find('.p_delete_twitter').attr('href',url_del);});$('.p_set_elite').bind('click',Group.poster_set_elite);$('.p_remove_elite').bind('click',Group.poster_remove_elite);$('.p_delete_twitter').bind('click',Group.poster_delete_twitter);$('.p_remove_elite').hover(function(){$(this).html('取消');},function(){$(this).html('已加精');});$posters.hover(function(){$(this).find('ul').removeClass('none').addClass('none');$(this).find('.dropdown').removeClass('none');},function(){$(this).find('.dropdown').addClass('none');});$posters.find('.dropdown').hover(function(){$(this).find('ul').slideDown('fast');},function(){$(this).find('ul').slideUp('fast');});};(function($){$.fn.extend({group_commentize:function(options){var $message=$('<div class="message"></div>');$message.appendTo('body').hide();var smileys={1:{title:'笑'},24:{title:'色色'},9:{title:'酷'},6:{title:'流泪'},8:{title:'抓狂'},11:{title:'坏笑'},4:{title:'害羞'},19:{title:'财迷'},13:{title:'猪头'},25:{title:'调皮'},16:{title:'转眼珠'},3:{title:'泪汪汪'},20:{title:'星星眼'},23:{title:'飞吻'},18:{title:'长草'},2:{title:'晕死'},5:{title:'问号'},17:{title:'刚巴德'},26:{title:'拒绝'},7:{title:'得意'},22:{title:'鄙视'},14:{title:'猥琐'},15:{title:'囧'},10:{title:'怒'},12:{title:'心碎'},21:{title:'白菜'},27:{title:'骷髅'},28:{title:'泪'},29:{title:'汗'},30:{title:'么么'},31:{title:'如花'},32:{title:'思考'}};var $smileys=$('<div class="smileys shadow popup"><ul></ul></div>');var $inner=$smileys.find('ul');$.each(smileys,function(key,smiley){$inner.append('<li class="smiley" id="'+key+'" title="'+smiley.title+'">'+'<img emotion="['+smiley.title+']" alt="'+smiley.title+'" src="'+Meilishuo.config.picture_url+'css/images/face/'+key+'.gif">'+'</li>');});$smileys.hide().appendTo('body');return this.each(function(){var $avatar=$(this).find('.current_user_avatar');var $editor=$(this).find('textarea');var $comment_box=$(this);var $comments_list=$(this).find('.note-list');var $toggle_smileys=$(this).find('.toggle_smileys');var $submit=$(this).find('.submit');var $forward=$(this).find('input.forward');var tid=$(this).find('input[name=tid]').val();var default_text='说点什么吧...';var $pager=$(this).find('.pager');var $toggle_reply=$(this).closest('.gt_comm').siblings('.twitter_r').find('.toggle_reply');var $toggle_forward=$(this).closest('.gt_comm').siblings('.twitter_r').find('.toggle_forward');var $count_reply=$toggle_reply.find('em');var $count_forward=$toggle_forward.find('em');var reply_to_comment=function(){var nickname=$(this).attr('nickname');var default_text='回复@'+nickname+' : ';var v=$editor.val();var found=v.search(default_text);if(0!=found){$editor.val(default_text+v);}
var len=$editor.val().length;$editor.selectRange(len,len);$editor.focus();return false;}
var pager_link_process=function(){var url=$(this).attr('href');var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);if(response.status){$comments_list.fadeOut(100,function(){$(this).html(response.html).fadeIn(100);$comment_box.find('.pager').find('a:not(.js_processed)').click(pager_link_process);$(this).find('.toggle_reply_comment').click(reply_to_comment);});$count_reply.html('('+response.total+')');}
else{}};$.post(url,data,callback);return false;};$pager.find('a:not(.js_processed)').click(pager_link_process).addClass('js_processed');$editor.elastic();var show_message=function(text){$message.html(text);var offset=$editor.offset();$message.css({top:offset.top,left:offset.left+$editor.width()-$message.width()-3}).show();};var hide_message=function(){$message.hide();};var getByteLen=function(val){var len=0;for(var i=0;i<val.length;i++){var char=val.substr(i,1);if(char.match(/[^\x00-\xff]/ig)!=null)
len+=2;else
len+=1;}
return len;};var getByteVal=function(val,max){var returnValue='';var byteValLen=0;for(var i=0;i<val.length;i++){var char=val.substr(i,1);if(char.match(/[^\x00-\xff]/ig)!=null)
byteValLen+=2;else
byteValLen+=1;if(byteValLen>max)
break;returnValue+=char;}
return returnValue;};var limit=280;var count=function(){var content=$(this).val();if(getByteLen(content)>limit){$(this).val(getByteVal(content,limit));}};$editor.keydown(count).focus(count).blur(count);var f=function(){$comment_box.toggle();if($comment_box.is(':visible')){$editor.focus();}
else{hide_message();$smileys.hide();}
var $toggle_picture=$('#twitter_editor .toggle_picture');var $upload_form=$('#twitter_editor form');var $upload_handle=$upload_form.find('.upload_file');var offset=$toggle_picture.offset();$upload_handle.css({'top':offset.top+2,'left':offset.left-10});return false;};$toggle_reply.click(f);$toggle_forward.click(f);$toggle_smileys.click(function(){if($smileys.is(':visible')){$smileys.hide();return false;}
var offset=$toggle_smileys.offset();var smileys_position={top:offset.top+$toggle_smileys.height(),left:offset.left};$smileys.css(smileys_position);$smileys.find('.smiley').unbind('click').click(function(){$editor.insertAtCaret('['+$(this).attr('title')+']');var len=$editor.val().length;$editor.selectRange(len,len);});$smileys.show();$editor.focus();return false;});$editor.click(function(){$smileys.hide();hide_message();});var in_submit=false;$submit.click(function(){if(in_submit)return false;$smileys.hide();var $e=$(this);if(0==current_user_id||''==current_user_id){showLoginWin();return false;}
var content=$editor.val();if(content.trim().length==0){show_message('说两句吧～～～');return false;}
in_submit=true;show_message('正在提交...');var forward=$forward.attr('checked')?1:0;var url='/twitter/ajax_newNoteTwitter';var data={'suid':current_user_id,'stid':tid,'type':4,'tContent':$editor.val(),'pid':0,'showIndex':forward};var callback=function(){var url='/group/1/ajax_load_twitter_comments?twitter_id='+tid;var data={'ajax':1};var callback=function(response){response=$.JSON.decode(response);if(response.status){$comments_list.fadeOut(100,function(){$(this).html(response.html).fadeIn(100);$comment_box.find('.pager').find('a:not(.js_processed)').click(pager_link_process);$(this).find('.toggle_reply_comment').click(reply_to_comment);});$count_reply.html('('+response.total+')');}
else{}};$.post(url,data,callback);$editor.val('');$editor.css('height',28);hide_message();in_submit=false;};$.post(url,data,callback);return false;});$(this).find('.toggle_reply_comment').click(reply_to_comment);});}});})(jQuery);