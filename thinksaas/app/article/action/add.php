<?phpdefined('IN_TS') or die('Access Denied.');$userid = intval($TS_USER['user']['userid']);if($userid == 0){	header("Location: ".SITE_URL.tsurl('user','login'));	exit;}switch($ts){	case "":				$cateid = intval($_GET['cateid']);				$arrCate = $new['article']->getArrCate();				$title = '发布文章';		include template('add');		break;			case "do":		$cateid = $_POST['cateid'];		$title	= htmlspecialchars(trim($_POST['title']));		$content = trim($_POST['content']);		$addtime = time();				if($title=='' || $content=='') qiMsg("标题和内容都不能为空！");				$isphoto = 0;		$isattach = 0;				//判断是否有图片和附件		preg_match_all('/\[(photo)=(\d+)\]/is', $content, $photo);		if($photo[2]){			$isphoto = '1';		}		//判断附件		preg_match_all('/\[(attach)=(\d+)\]/is', $content, $attach);		if($attach[2]){			$isattach = '1';		}				$db->query("insert into ".dbprefix."article (`userid`,`cateid`,`title`,`content`,`isphoto`,`isattach`,`isaudit`,`addtime`) values ('$userid','$cateid','$title','$content','$isphoto','$isattach','1','$addtime')");				$articleid = $db->insert_id();				//处理标签		aac('tag')->addTag('article','articleid',$articleid,$_POST['tag']);				header("Location: ".SITE_URL.tsurl('article','show',array('articleid'=>$articleid)));			break;	}