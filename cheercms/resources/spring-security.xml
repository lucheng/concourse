<?xml version="1.0" encoding="UTF-8"?>  
<beans:beans xmlns="http://www.springframework.org/schema/security"  
    xmlns:beans="http://www.springframework.org/schema/beans"  
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"  
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd  
                        http://www.springframework.org/schema/security http://www.springframework.org/schema/security/spring-security-3.1.xsd">  
                          
    <global-method-security pre-post-annotations="enabled" />   
    <!-- 该路径下的资源不用过滤 --> 
    
    <http pattern="/js/**" security="none"/>
    <http pattern="/css/**" security="none"/>
    <http pattern="/images/**" security="none"/>
    <http pattern="/upload/**" security="none"/>
	<http pattern="/captchaImage" security="none"/>
    
    <http>
	    <form-login login-page="/manage/login" login-processing-url="/j_spring_security_check" default-target-url="/manage/index" authentication-failure-url="/manage/login?login_error=1"/>
	    <logout logout-url="/manage/logout" logout-success-url="/manage/login"/>
	    <remember-me  />
		<!-- 会话配置管理 -->
		<session-management invalid-session-url="/manage/login">
		<!-- 只允许一个人登陆,并且第二个人登陆不了 -->
		<concurrency-control max-sessions="1" error-if-maximum-exceeded="true" />
		</session-management>
	</http>
	
	<authentication-manager alias="authenticationManager">
	    <authentication-provider>
	    	<jdbc-user-service data-source-ref="dataSource"></jdbc-user-service>
			<user-service>
	        	<user name="admin" password="admin" authorities="ROLE_USER, ROLE_ADMIN" />
	        	<user name="user" password="user" authorities="ROLE_USER" />
			</user-service>
	    </authentication-provider>
	</authentication-manager>
    
    <!-- Jcaptcha相关的配置 -->
	<beans:bean id="captchaService" class="com.octo.captcha.service.image.DefaultManageableImageCaptchaService">
		<beans:property name="captchaEngine">
			<beans:bean class="edu.bupt.spring.utils.CaptchaEngine" />
		</beans:property>
		<!-- 默认生成的图片180秒过期 , 可另行设置 
		<property name="minGuarantedStorageDelayInSeconds" value="180" />
		-->
	</beans:bean>
    
    <!-- 配置过滤器 -->  
    <!--<beans:bean id="myFilter" class="edu.bupt.spring.web.security.MySecurityFilter">  
         用户拥有的权限   
        <beans:property name="authenticationManager" ref="myAuthenticationManager" />  
         用户是否拥有所请求资源的权限
        <beans:property name="accessDecisionManager" ref="myAccessDecisionManager" />  
         资源与权限对应关系   
        <beans:property name="securityMetadataSource" ref="mySecurityMetadataSource" />  
    </beans:bean>
    
     实现了UserDetailsService的Bean   
    <authentication-manager alias="myAuthenticationManager">  
        <authentication-provider user-service-ref="myUserDetailServiceImpl" />  
    </authentication-manager>
    
    <beans:bean id="myAccessDecisionManager" class="edu.bupt.spring.web.security.MyAccessDecisionManager">
    </beans:bean>
    
    <beans:bean id="mySecurityMetadataSource" class="edu.bupt.spring.web.security.MySecurityMetadataSource">  
        <beans:constructor-arg name="resourceService" ref="resourceServiceImpl"></beans:constructor-arg>  
    </beans:bean>
    
    <beans:bean id="myUserDetailServiceImpl" class="edu.bupt.spring.web.security.MyUserDetailServiceImpl">  
        <beans:property name="adminService" ref="userServiceImpl"></beans:property>  
    </beans:bean>
    
    <beans:bean id="userServiceImpl" class="edu.bupt.spring.service.impl.UserServiceImpl">  
    </beans:bean>
    
    <beans:bean id="resourceServiceImpl" class="edu.bupt.spring.service.impl.ResourceServiceImpl">  
    </beans:bean>
-->
</beans:beans> 